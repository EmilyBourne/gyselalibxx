cmake_tests:
  only: [ main, merge_requests ]
  stage: test
  needs: []
  image: jbigot/voicexx_env
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  script: |
    rm -rf build || true
    mkdir build
    cd build
    cmake -DCMAKE_CXX_FLAGS=-Wall -DBUILD_BENCHMARKS=ON ..
    make -j 2 VERBOSE=1
    ctest --output-on-failure --timeout 5 --output-junit tests.xml
    ls *
  artifacts:
    when: always
    reports:
      junit: ./build/tests.xml
indentation:
  only: [ main, merge_requests ]
  stage: test
  needs: []
  image: jbigot/voicexx_env
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  script: |
    ./bin/indent -td
